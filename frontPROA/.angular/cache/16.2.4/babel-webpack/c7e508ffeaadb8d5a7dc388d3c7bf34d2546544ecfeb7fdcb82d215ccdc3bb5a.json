{"ast":null,"code":"import PDFDict from \"../objects/PDFDict\";\nimport PDFString from \"../objects/PDFString\";\nimport PDFHexString from \"../objects/PDFHexString\";\nimport PDFName from \"../objects/PDFName\";\nimport PDFNumber from \"../objects/PDFNumber\";\nimport PDFArray from \"../objects/PDFArray\";\nimport PDFRef from \"../objects/PDFRef\";\nimport { findLastMatch } from \"../../utils\";\nimport { MissingDAEntryError, MissingTfOperatorError } from \"../errors\";\n// Examples:\n//   `/Helv 12 Tf` -> ['Helv', '12']\n//   `/HeBo 8.00 Tf` -> ['HeBo', '8.00']\n//   `/HeBo Tf` -> ['HeBo', undefined]\nvar tfRegex = /\\/([^\\0\\t\\n\\f\\r\\ ]+)[\\0\\t\\n\\f\\r\\ ]*(\\d*\\.\\d+|\\d+)?[\\0\\t\\n\\f\\r\\ ]+Tf/;\nvar PDFAcroField = /** @class */function () {\n  function PDFAcroField(dict, ref) {\n    this.dict = dict;\n    this.ref = ref;\n  }\n  PDFAcroField.prototype.T = function () {\n    return this.dict.lookupMaybe(PDFName.of('T'), PDFString, PDFHexString);\n  };\n  PDFAcroField.prototype.Ff = function () {\n    var numberOrRef = this.getInheritableAttribute(PDFName.of('Ff'));\n    return this.dict.context.lookupMaybe(numberOrRef, PDFNumber);\n  };\n  PDFAcroField.prototype.V = function () {\n    var valueOrRef = this.getInheritableAttribute(PDFName.of('V'));\n    return this.dict.context.lookup(valueOrRef);\n  };\n  PDFAcroField.prototype.Kids = function () {\n    return this.dict.lookupMaybe(PDFName.of('Kids'), PDFArray);\n  };\n  // Parent(): PDFDict | undefined {\n  //   return this.dict.lookupMaybe(PDFName.of('Parent'), PDFDict);\n  // }\n  PDFAcroField.prototype.DA = function () {\n    var da = this.dict.lookup(PDFName.of('DA'));\n    if (da instanceof PDFString || da instanceof PDFHexString) return da;\n    return undefined;\n  };\n  PDFAcroField.prototype.setKids = function (kids) {\n    this.dict.set(PDFName.of('Kids'), this.dict.context.obj(kids));\n  };\n  PDFAcroField.prototype.getParent = function () {\n    // const parent = this.Parent();\n    // if (!parent) return undefined;\n    // return new PDFAcroField(parent);\n    var parentRef = this.dict.get(PDFName.of('Parent'));\n    if (parentRef instanceof PDFRef) {\n      var parent_1 = this.dict.lookup(PDFName.of('Parent'), PDFDict);\n      return new PDFAcroField(parent_1, parentRef);\n    }\n    return undefined;\n  };\n  PDFAcroField.prototype.setParent = function (parent) {\n    if (!parent) this.dict.delete(PDFName.of('Parent'));else this.dict.set(PDFName.of('Parent'), parent);\n  };\n  PDFAcroField.prototype.getFullyQualifiedName = function () {\n    var parent = this.getParent();\n    if (!parent) return this.getPartialName();\n    return parent.getFullyQualifiedName() + \".\" + this.getPartialName();\n  };\n  PDFAcroField.prototype.getPartialName = function () {\n    var _a;\n    return (_a = this.T()) === null || _a === void 0 ? void 0 : _a.decodeText();\n  };\n  PDFAcroField.prototype.setPartialName = function (partialName) {\n    if (!partialName) this.dict.delete(PDFName.of('T'));else this.dict.set(PDFName.of('T'), PDFHexString.fromText(partialName));\n  };\n  PDFAcroField.prototype.setDefaultAppearance = function (appearance) {\n    this.dict.set(PDFName.of('DA'), PDFString.of(appearance));\n  };\n  PDFAcroField.prototype.getDefaultAppearance = function () {\n    var DA = this.DA();\n    if (DA instanceof PDFHexString) {\n      return DA.decodeText();\n    }\n    return DA === null || DA === void 0 ? void 0 : DA.asString();\n  };\n  PDFAcroField.prototype.setFontSize = function (fontSize) {\n    var _a;\n    var name = (_a = this.getFullyQualifiedName()) !== null && _a !== void 0 ? _a : '';\n    var da = this.getDefaultAppearance();\n    if (!da) throw new MissingDAEntryError(name);\n    var daMatch = findLastMatch(da, tfRegex);\n    if (!daMatch.match) throw new MissingTfOperatorError(name);\n    var daStart = da.slice(0, daMatch.pos - daMatch.match[0].length);\n    var daEnd = daMatch.pos <= da.length ? da.slice(daMatch.pos) : '';\n    var fontName = daMatch.match[1];\n    var modifiedDa = daStart + \" /\" + fontName + \" \" + fontSize + \" Tf \" + daEnd;\n    this.setDefaultAppearance(modifiedDa);\n  };\n  PDFAcroField.prototype.getFlags = function () {\n    var _a, _b;\n    return (_b = (_a = this.Ff()) === null || _a === void 0 ? void 0 : _a.asNumber()) !== null && _b !== void 0 ? _b : 0;\n  };\n  PDFAcroField.prototype.setFlags = function (flags) {\n    this.dict.set(PDFName.of('Ff'), PDFNumber.of(flags));\n  };\n  PDFAcroField.prototype.hasFlag = function (flag) {\n    var flags = this.getFlags();\n    return (flags & flag) !== 0;\n  };\n  PDFAcroField.prototype.setFlag = function (flag) {\n    var flags = this.getFlags();\n    this.setFlags(flags | flag);\n  };\n  PDFAcroField.prototype.clearFlag = function (flag) {\n    var flags = this.getFlags();\n    this.setFlags(flags & ~flag);\n  };\n  PDFAcroField.prototype.setFlagTo = function (flag, enable) {\n    if (enable) this.setFlag(flag);else this.clearFlag(flag);\n  };\n  PDFAcroField.prototype.getInheritableAttribute = function (name) {\n    var attribute;\n    this.ascend(function (node) {\n      if (!attribute) attribute = node.dict.get(name);\n    });\n    return attribute;\n  };\n  PDFAcroField.prototype.ascend = function (visitor) {\n    visitor(this);\n    var parent = this.getParent();\n    if (parent) parent.ascend(visitor);\n  };\n  return PDFAcroField;\n}();\nexport default PDFAcroField;\n//# sourceMappingURL=PDFAcroField.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}