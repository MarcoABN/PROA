{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { ReparseError } from \"../errors\";\nimport PDFName from \"../objects/PDFName\";\nimport PDFNumber from \"../objects/PDFNumber\";\nimport PDFRef from \"../objects/PDFRef\";\nimport ByteStream from \"./ByteStream\";\nimport PDFObjectParser from \"./PDFObjectParser\";\nimport { waitForTick } from \"../../utils\";\nvar PDFObjectStreamParser = /** @class */function (_super) {\n  __extends(PDFObjectStreamParser, _super);\n  function PDFObjectStreamParser(rawStream, shouldWaitForTick) {\n    var _this = _super.call(this, ByteStream.fromPDFRawStream(rawStream), rawStream.dict.context) || this;\n    var dict = rawStream.dict;\n    _this.alreadyParsed = false;\n    _this.shouldWaitForTick = shouldWaitForTick || function () {\n      return false;\n    };\n    _this.firstOffset = dict.lookup(PDFName.of('First'), PDFNumber).asNumber();\n    _this.objectCount = dict.lookup(PDFName.of('N'), PDFNumber).asNumber();\n    return _this;\n  }\n  PDFObjectStreamParser.prototype.parseIntoContext = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var offsetsAndObjectNumbers, idx, len, _a, objectNumber, offset, object, ref;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (this.alreadyParsed) {\n              throw new ReparseError('PDFObjectStreamParser', 'parseIntoContext');\n            }\n            this.alreadyParsed = true;\n            offsetsAndObjectNumbers = this.parseOffsetsAndObjectNumbers();\n            idx = 0, len = offsetsAndObjectNumbers.length;\n            _b.label = 1;\n          case 1:\n            if (!(idx < len)) return [3 /*break*/, 4];\n            _a = offsetsAndObjectNumbers[idx], objectNumber = _a.objectNumber, offset = _a.offset;\n            this.bytes.moveTo(this.firstOffset + offset);\n            object = this.parseObject();\n            ref = PDFRef.of(objectNumber, 0);\n            this.context.assign(ref, object);\n            if (!this.shouldWaitForTick()) return [3 /*break*/, 3];\n            return [4 /*yield*/, waitForTick()];\n          case 2:\n            _b.sent();\n            _b.label = 3;\n          case 3:\n            idx++;\n            return [3 /*break*/, 1];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  PDFObjectStreamParser.prototype.parseOffsetsAndObjectNumbers = function () {\n    var offsetsAndObjectNumbers = [];\n    for (var idx = 0, len = this.objectCount; idx < len; idx++) {\n      this.skipWhitespaceAndComments();\n      var objectNumber = this.parseRawInt();\n      this.skipWhitespaceAndComments();\n      var offset = this.parseRawInt();\n      offsetsAndObjectNumbers.push({\n        objectNumber: objectNumber,\n        offset: offset\n      });\n    }\n    return offsetsAndObjectNumbers;\n  };\n  PDFObjectStreamParser.forStream = function (rawStream, shouldWaitForTick) {\n    return new PDFObjectStreamParser(rawStream, shouldWaitForTick);\n  };\n  return PDFObjectStreamParser;\n}(PDFObjectParser);\nexport default PDFObjectStreamParser;","map":{"version":3,"names":["__awaiter","__extends","__generator","ReparseError","PDFName","PDFNumber","PDFRef","ByteStream","PDFObjectParser","waitForTick","PDFObjectStreamParser","_super","rawStream","shouldWaitForTick","_this","call","fromPDFRawStream","dict","context","alreadyParsed","firstOffset","lookup","of","asNumber","objectCount","prototype","parseIntoContext","offsetsAndObjectNumbers","idx","len","_a","objectNumber","offset","object","ref","_b","label","parseOffsetsAndObjectNumbers","length","bytes","moveTo","parseObject","assign","sent","skipWhitespaceAndComments","parseRawInt","push","forStream"],"sources":["E:/PROA/frontPROA/node_modules/pdf-lib/es/core/parser/PDFObjectStreamParser.js"],"sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\nimport { ReparseError } from \"../errors\";\nimport PDFName from \"../objects/PDFName\";\nimport PDFNumber from \"../objects/PDFNumber\";\nimport PDFRef from \"../objects/PDFRef\";\nimport ByteStream from \"./ByteStream\";\nimport PDFObjectParser from \"./PDFObjectParser\";\nimport { waitForTick } from \"../../utils\";\nvar PDFObjectStreamParser = /** @class */ (function (_super) {\n    __extends(PDFObjectStreamParser, _super);\n    function PDFObjectStreamParser(rawStream, shouldWaitForTick) {\n        var _this = _super.call(this, ByteStream.fromPDFRawStream(rawStream), rawStream.dict.context) || this;\n        var dict = rawStream.dict;\n        _this.alreadyParsed = false;\n        _this.shouldWaitForTick = shouldWaitForTick || (function () { return false; });\n        _this.firstOffset = dict.lookup(PDFName.of('First'), PDFNumber).asNumber();\n        _this.objectCount = dict.lookup(PDFName.of('N'), PDFNumber).asNumber();\n        return _this;\n    }\n    PDFObjectStreamParser.prototype.parseIntoContext = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var offsetsAndObjectNumbers, idx, len, _a, objectNumber, offset, object, ref;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (this.alreadyParsed) {\n                            throw new ReparseError('PDFObjectStreamParser', 'parseIntoContext');\n                        }\n                        this.alreadyParsed = true;\n                        offsetsAndObjectNumbers = this.parseOffsetsAndObjectNumbers();\n                        idx = 0, len = offsetsAndObjectNumbers.length;\n                        _b.label = 1;\n                    case 1:\n                        if (!(idx < len)) return [3 /*break*/, 4];\n                        _a = offsetsAndObjectNumbers[idx], objectNumber = _a.objectNumber, offset = _a.offset;\n                        this.bytes.moveTo(this.firstOffset + offset);\n                        object = this.parseObject();\n                        ref = PDFRef.of(objectNumber, 0);\n                        this.context.assign(ref, object);\n                        if (!this.shouldWaitForTick()) return [3 /*break*/, 3];\n                        return [4 /*yield*/, waitForTick()];\n                    case 2:\n                        _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        idx++;\n                        return [3 /*break*/, 1];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PDFObjectStreamParser.prototype.parseOffsetsAndObjectNumbers = function () {\n        var offsetsAndObjectNumbers = [];\n        for (var idx = 0, len = this.objectCount; idx < len; idx++) {\n            this.skipWhitespaceAndComments();\n            var objectNumber = this.parseRawInt();\n            this.skipWhitespaceAndComments();\n            var offset = this.parseRawInt();\n            offsetsAndObjectNumbers.push({ objectNumber: objectNumber, offset: offset });\n        }\n        return offsetsAndObjectNumbers;\n    };\n    PDFObjectStreamParser.forStream = function (rawStream, shouldWaitForTick) { return new PDFObjectStreamParser(rawStream, shouldWaitForTick); };\n    return PDFObjectStreamParser;\n}(PDFObjectParser));\nexport default PDFObjectStreamParser;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}